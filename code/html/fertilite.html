<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alertes de fertilité</title>
</head>
<body>
    <h1>Calcul des jours de fertilité maximale</h1>
    <form id="fertilityForm">
        <label for="startDate">Date de début des dernières règles :</label>
        <input type="date" id="startDate" required><br><br>

        <label for="cycleLength">Durée moyenne du cycle (en jours) :</label>
        <input type="number" id="cycleLength" min="21" max="35" required><br><br>

        <button type="submit">Calculer mes jours fertiles et activer les notifications</button>
    </form>

    <div id="result"></div>

    <script>
        document.getElementById('fertilityForm').addEventListener('submit', function(event) {
            event.preventDefault();

            // Récupérer les valeurs
            const startDate = new Date(document.getElementById('startDate').value);
            const cycleLength = parseInt(document.getElementById('cycleLength').value);

            // Calcul des jours fertiles
            const ovulationDay = new Date(startDate);
            ovulationDay.setDate(startDate.getDate() + (cycleLength - 14)); // Ovulation environ 14 jours avant les prochaines règles

            const fertileStart = new Date(ovulationDay);
            fertileStart.setDate(ovulationDay.getDate() - 5); // Fenêtre fertile commence 5 jours avant

            const fertileEnd = new Date(ovulationDay);
            fertileEnd.setDate(ovulationDay.getDate() + 1); // Fenêtre fertile termine 1 jour après

            // Affichage des résultats
            document.getElementById('result').innerHTML = `
                <p>Votre période fertile estimée est du 
                <strong>${fertileStart.toDateString()}</strong> 
                au 
                <strong>${fertileEnd.toDateString()}</strong>.
                </p>
            `;

            // Vérifier les permissions pour les notifications
            if (Notification.permission === "granted") {
                scheduleNotifications(fertileStart, fertileEnd);
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        scheduleNotifications(fertileStart, fertileEnd);
                    }
                });
            }
        });

        // Fonction pour planifier les notifications de fertilité
        function scheduleNotifications(fertileStart, fertileEnd) {
            const now = new Date();
            
            if (fertileStart > now) {
                // Notification pour le début de la période fertile
                const timeUntilStart = fertileStart - now;
                setTimeout(() => {
                    new Notification("Votre période fertile commence aujourd'hui !");
                }, timeUntilStart);
            }

            if (fertileEnd > now) {
                // Notification pour la fin de la période fertile
                const timeUntilEnd = fertileEnd - now;
                setTimeout(() => {
                    new Notification("Votre période fertile se termine demain !");
                }, timeUntilEnd - 24 * 60 * 60 * 1000); // 1 jour avant la fin
            }

            // Test pour une notification instantanée (supprimez ceci dans la vraie app)
            setTimeout(() => {
                new Notification("Notification test : Fertilité activée !");
            }, 5000); // Test après 5 secondes
        }
    </script>
</body>
</html>
